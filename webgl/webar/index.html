<!DOCTYPE html>
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta http-equiv="Cache-Control" content="no-cache">
<meta name="viewport" content="initial-scale=1.0,maximum-scale=1.0,minimum-scale=1.0,user-scalable=no">
<title>JC_demo</title>
<style type="text/css">
    * {
        padding: 0;
        margin: 0;
    }

    body {
        position: relative;
        overflow: hidden;
        background-color: #fff;
    }
</style>
</head>

<body>
<video id="webcam"></video>
<canvas id="webar"></canvas>
<script type="text/javascript" src="./js/compatibility.js"></script>
<script type="text/javascript" src="./js/jsfeat-min.js"></script>
<script type="text/javascript" src="./js/profiler.js"></script>
<script type="text/javascript">
    var video = document.getElementById('webcam');
    var canvas = document.getElementById('webar');

    try {
        var attempts = 0;
        var readyListener = function(event) {
            findVideoSize();
        };
        var findVideoSize = function() {
            if(video.videoWidth > 0 && video.videoHeight > 0) {
                video.removeEventListener('loadeddata', readyListener);
                onDimensionsReady(video.videoWidth, video.videoHeight);
            } else {
                if(attempts < 10) {
                    attempts++;
                    setTimeout(findVideoSize, 200);
                } else {
                    onDimensionsReady(640, 480);
                }
            }
        };
        var onDimensionsReady = function(width, height) {
            demo_app(width, height);
            compatibility.requestAnimationFrame(tick);
        };

        video.addEventListener('loadeddata', readyListener);
        navigator.mediaDevices.getUserMedia({video: { facingMode: { exact: "environment" } }}, function(stream) {
            try {
                video.src = compatibility.URL.createObjectURL(stream);
            } catch (error) {
                video.src = stream;
            }
            setTimeout(function() {
                video.play();
            }, 500);
        }, function (error) {
            alert(error);
        });
    } catch (error) {
        alert(error);
    }
</script>
</body>
</html>
